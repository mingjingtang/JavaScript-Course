<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Asynchronous JavaScript</title>
  </head>
  <body>
    <h1>Asynchronous JavaScript</h1>
    <script>
      /*
      const first = () => {
        console.log("Hey there!");  
        second();
        console.log("The end.");
      };

      const second = () => {
        setTimeout(() => {
          console.log("Async Hey there!");
        }, 2000);
      };

      first();
      */

      const getIDs = new Promise((resolve, reject) => {
        const IDs = [324, 569, 399, 976];
        setTimeout(() => {
          resolve(IDs);
        }, 1500);
      });

      const getRecipe = recID => {
        return new Promise((resolve, reject) => {
          setTimeout(
            ID => {
              const recipe = { author: "mingjing", dish: "shrimp spaghetti" };
              resolve(recipe);
            },
            1500,
            recID
          );
        });
      };

      const getRelated = author => {
        return new Promise((resolve, reject) => {
          setTimeout(
            auth => {
              const recipe = { author: "mingjing", dish: "strawberry banana" };
              if (recipe.author == auth) {
                resolve(recipe);
              } else {
                console.log(`can't find ${auth}\'s dish`);
              }
            },
            1500,
            author
          );
        });
      };

      /*
      getIDs
        .then(IDs => {
          console.log(IDs);
          return getRecipe(IDs[2]);
        })
        .then(ID => {
          console.log(ID);
          return getRelated(ID.author);
        })
        .then(author => {
          console.log(author);
        })
        .catch(error => {
          console.log(error);
        });

      async function getRecipeTest() {
        const IDs = await getIDs;
        console.log(IDs);
        const ID2 = await getRecipe(IDs[2]);
        console.log(ID2);
        const related = await getRelated(ID2.author);
        console.log(related);

        return related;
      }

      getRecipeTest().then(result =>
        console.log(`${result.dish} is the best!`)
      );
      */

      async function getWeatherAW(woeid) {
        try {
          const result = await fetch(
            `https://cors-anywhere.herokuapp.com/https://www.metaweather.com/api/location/${woeid}`
          );
          const jsonData = await result.json();
          const today = jsonData.consolidated_weather[0];
          console.log(
            `Temperatures today in ${jsonData.title} stay between ${today.max_temp} and ${today.min_temp}`
          );
          return jsonData;
        } catch (err) {
          console.log(err);
        }
      }

      getWeatherAW(44418);
      let londonData;
      getWeatherAW(2487956).then(data => {
        londonData = data.title;
        console.log(londonData);
      });
    </script>
  </body>
</html>
